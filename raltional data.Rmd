---
title: "relational data"
author: "Dylan Lange"
date: "October 24, 2017"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r, include=FALSE}
library(tidyverse)
library(nycflights13)
library(babynames)
library(nasaweather)
library(fueleconomy)
```

#Chapter 10

##Group 1 Exercises

###Exercise 1
In order to track this, you will need the variables origin, destination, including the latitude and longitude for the airports.  To do this you need to combine weather and airports to the flights table in order to get the origin, dest, and latitude and longitude for each.  You could also factor in the weather for the flights if you were interested in some very complex math.

###Exercise 2
The relationship between weather and airports is that origin is faa from the airports table.  THis table should show an arrow from faa in airports to origin in weather, then from weather to origin in the flights table.

###Exercise 3
It could also define the relationship to the destination, via the location of the destination and its code.  You could also model the reason for the delays, whether that be weather in the origin airport of the destination airport.

###Exercise 4
I would represent it as a holiday data frame.  It would include dates and times of these special days from the weather table.  I would also include origin and destination from airports as well as the carriers variable from the airlines table.  

##Group 2 Exercises

###Exercise 1
```{r}
mutate(flights, key=row_number())
```

###Exercise 2
 * a: They key is a combination of PlayerID, YearID, Stint, and TeamID.  The player can play in multiple years, multiple stints, within a year, and with multiple teams, so the combination of them is a composite key
 * b: There doesn't seem to be a key within the babynames data, the key would need to be a surrogate key by row number.
 * c: year,month seems to be the key for this data because each observation is once per month each year.
 * d: id is the key for this table because each vehicle has a separate id.
 * e: There is no key in this data set.  A surrogate key would have to be added by row number.
 
###Exercise 3


##Group 2 Exercises

###Exercise 1
```{r}
flights2<-flights%>%
  group_by(dest)%>%
  summarise(average=mean(dep_delay,na.rm=TRUE))

airports%>%
  inner_join(flights2, c("faa"="dest"))%>%
  ggplot(aes(lon,lat, color=average))+
    borders("state")+
    geom_point()+
    coord_quickmap()
```

###Exercise 2
```{r}
flights %>%
  left_join(airports, c("dest"="faa")) %>%
  left_join(airports, c("origin"="faa"))
```

###Exercise 3
```{r}
flights%>%
  left_join(planes, by="tailnum")%>%
  select(year.x:day, dep_delay:dep_delay, year.y:year.y, tailnum:tailnum)%>%
  ggplot()+
  geom_point(aes(x=dep_delay, y=year.y))
```

There really isn't a relationship between age of the plane and delays.  While newer planes have more delays, they are also used more often.

###Exercise 4
```{r}
weather%>%
  inner_join(flights)%>%
  select(origin:visib, dep_delay)%>%
  ggplot()+
  geom_point(mapping=aes(x=dep_delay, y=humid))
```

There appears to be small relation between humidity and departure delays.  High humidity does not necessarily result in delays, but you are more likely to be delayed if the humidity is higher.

###Exercise 5
```{r}
flights3<-weather%>%
  right_join(flights, by=c("origin", "year", "month", "day", "hour"))%>%
  filter(month==6, day==13, year==2013) %>%
  group_by(dest)%>%
  summarise(average=mean(dep_delay,na.rm=TRUE))

airports%>%
  inner_join(flights3, c("faa"="dest"))%>%
  ggplot(aes(lon,lat, color=average))+
    borders("state")+
    geom_point()+
    coord_quickmap()
```

On June 12 and 13, there were two derecho weather events, which are extremely sever thunderstorms causing delays accross the destinations on the map.

